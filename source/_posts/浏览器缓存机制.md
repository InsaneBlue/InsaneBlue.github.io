---
title: 浏览器缓存机制
date: 2018-05-14 11:26:55
tags: http
categories: http
---

# 浏览器缓存机制

## 前言

web缓存大致可以分为以下几个类型：数据库缓存、服务器缓存、浏览器缓存、web应用缓存。本文主要讨论的是服务器和浏览器两方面对于web资源（如图片、js文件、数据等等）的缓存策略和机制。

<!--more-->

## 缓存的作用

+ 减少网络带宽消耗：对于已缓存的文件，可以减少请求带宽甚至无需请求网络，可以有效的降低运营成本。

+ 降低服务器压力：给网络资源设定有效期之后，用户可以重复使用本地的缓存，减少对源服务器的请求，间接降低服务器的压力。同时，将一些静态资源放置在网络的多个节点，也可以起到均衡负载的作用。

+ 减少网络延迟，加快页面打开速度：缓存能在在不影响网站交互的前提下能够明显加快网站加载速度和页面打开速度。

## 缓存的类型

1. 数据库缓存

    Web应用，特别是关系比较复杂、数据库表繁多的应用，如果频繁进行数据库查询，很容易导致数据库不堪重荷。为了提供查询的性能，会将查询后的数据放到内存中进行缓存，下次查询时直接从内存缓存直接返回，提高响应效率。

2. 服务器缓存

    - 代理服务器缓存

      代理服务器是浏览器和源服务器之间的中间服务器，浏览器先向这个中间服务器发起Web请求，经过处理后（比如权限验证，缓存匹配等），再将请求转发到源服务器。代理服务器缓存的运作原理跟浏览器的运作原理差不多，只是规模更大。可以把它理解为一个共享缓存，不只为一个用户服务，一般为大量用户提供服务，因此在减少相应时间和带宽使用方面很有效，同一个副本会被重用多次。

    - CDN缓存

      CDN（Content delivery networks）缓存，也叫网关缓存、反向代理缓存、内容分发网络。CDN缓存一般是由网站管理员自己部署，为了让网站更容易扩展并获得更好的性能。浏览器先向CDN网关发起Web请求，网关服务器后面对应着一台或多台负载均衡源服务器，会根据它们的负载请求，动态将请求转发到合适的源服务器上。

3. 浏览器缓存 

    浏览器缓存根据一套与服务器约定的规则进行工作，在同一个会话过程中会检查一次并确定缓存的副本足够新。如果你浏览过程中，比如前进或后退，访问到同一个图片，这些图片可以立即从浏览器缓存中读取出来。

4. Web应用层缓存
    应用层缓存指的是从代码层面上，通过代码逻辑和缓存策略，实现对数据、页面、图片等资源的缓存，可以根据实际情况选择将数据存在文件系统或者内存中，减少请求次数，提高响应效率。

## 浏览器缓存机制

### 几个缓存相关的概念
- 新鲜度（过期机制）

  也就是缓存副本有效期。一个缓存副本必须满足以下条件，浏览器会认为它是有效的，足够新的：
    1. 含有完整的过期时间控制头信息（HTTP协议报头），并且仍在有效期内；
    2. 浏览器已经使用过这个缓存副本，并且在一个会话中已经检查过新鲜度；

- 校验值（验证机制）

  服务器返回资源时会在控制头信息带上这个资源的实体标签Etag（Entity Tag），它可以用来作为浏览器再次请求过程的校验标识。如过发现校验标识不匹配，说明资源已经被修改或过期，浏览器需要重新获取资源内容。

- 强缓存

  浏览器加载资源时，会对资源进行检查，若发现资源没有过期则直接从本地缓存中获取，不发送请求到服务器，不与服务器发生交互行为。

- 协商缓存

  浏览器加载资源时，若强缓存没有生效，浏览器就会发送请求到服务器，询问服务器此资源是否有变化。如果协商缓存生效，服务器会返回304告知浏览器可以直接使用缓存；如果协商缓存未生效，服务器会返回200并将最新的资源一起返回，浏览器就会使用最新的资源。

  ### 